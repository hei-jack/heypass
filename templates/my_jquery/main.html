<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="UTF-8" />
  <meta name="renderer" content="webkit" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- 引入ico图标 -->
  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
  <title>HeyPass-主页</title>
  <link rel="stylesheet" type="text/css" href="__CSS__/materialdesignicons.min.css">
  <link rel="stylesheet" type="text/css" href="__CSS__/base.css">
  <link rel="stylesheet" type="text/css" href="__CSS__/style.css">
</head>

<body>
  <!-- 后台真主页 main -->
  <div class="container-fluid p-t-15">

    <div class="row">
      <div class="col-md-6 col-xl-3">
        <div class="card bg-primary text-white">
          <div class="card-body clearfix">
            <div class="flex-box">
              <span class="img-avatar img-avatar-48 bg-translucent"><i class="mdi mdi-key-variant fs-22"></i></span>
              <span class="fs-22 lh-22 float-right">{$total.pass} 条</span>
            </div>
            <div class="text-right clear">密码记录</div>
          </div>
        </div>
      </div>

      <div class="col-md-6 col-xl-3">
        <div class="card bg-danger text-white">
          <div class="card-body clearfix">
            <div class="flex-box">
              <span class="img-avatar img-avatar-48 bg-translucent"><i class="mdi mdi-account fs-22"></i></span>
              <span class="fs-22 lh-22 float-right">{$total.user} 人</span>
            </div>
            <div class="text-right clear">亲友总数</div>
          </div>
        </div>
      </div>

      <div class="col-md-6 col-xl-3">
        <div class="card bg-success text-white">
          <div class="card-body clearfix">
            <div class="flex-box">
              <span class="img-avatar img-avatar-48 bg-translucent"><i class="mdi mdi-view-headline fs-22"></i></span>
              <span class="fs-22 lh-22 float-right">{$total.diary} 篇</span>
            </div>
            <div class="text-right clear">日记总数</div>
          </div>
        </div>
      </div>

      <div class="col-md-6 col-xl-3">
        <div class="card bg-purple text-white">
          <div class="card-body clearfix">
            <div class="flex-box">
              <span class="img-avatar img-avatar-48 bg-translucent"><i class="mdi mdi-clipboard-text fs-22"></i></span>
              <span class="fs-22 lh-22 float-right">{$total.memo} 条</span>
            </div>
            <div class="text-right clear">备忘总数</div>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-lg-12">
        <div class="card">
          <header class="card-header">
            <div class="card-title">操作日志</div>
          </header>
          <div class="card-body">
            <div class="table-container">
              <!-- 表格头部 按钮 -->
              <div class="table-head">
                <button id="clear_log" type="button" class="btn btn-danger">
                  <span class="mdi mdi-window-close"></span>清空日志
                </button>
                <!-- 奇怪的ie9 若将这两个元素放在上面button里面 直接不会渲染 也不会构造到dom树中 -->
                <input type="hidden" class="hidden" id="token" name="token" value="{$Request.token}" />
                <input type="hidden" class="hidden" name="sign" value="{$Think.config.rsa_public_key}" />
              </div>

              <!-- 表格内容 -->
              <div class="table-main">
                <!-- <table id="user-log" class="table-hover table-striped table-bordered"> -->
                <table id="user-log">
                </table>
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row">

      <div class="col-md-6 col-12">
        <div class="card">
          <header class="card-header">
            <div class="card-title">关于HeyPass</div>
          </header>
          <div class="card-body">
            <div class="about-heypass">
              <p>HeyPass是一款免费开源的个人隐私管理系统，目前实现了包括密码管理、日记管理、书写备忘等功能。</p>
              <p>开源不易，如果这个小玩意对你有用，或者你挺喜欢，记得务必帮我来个star————支持和鼓励我发表更多更优秀的作品。</p>
              <p class="code">当前版本：{:config('app_version')}</p>
              <p class="code">项目地址：<a href="https://github.com/hei-jack/heypass" target="_blank">https://github.com/hei-jack/heypass</a></p>
              <p class="code">From hei-jack</p>
            </div>
            <div class="from-group">
              <button type="button" class="btn btn-success btn-round btn-w-md" id="help">使用教程</button>
              <button type="button" class="btn btn-primary btn-round btn-w-md" id="rand">随机密码</button>
            </div>

          </div>
        </div>
      </div>

      <div class="col-md-6 col-12">
        <div class="card">
          <header class="card-header">
            <div class="card-title">服务器信息</div>
          </header>
          <div class="card-body">
            <div class="server-info user-select">
              <p>操作系统：<span>{$sys_info.system}</span></p>
              <p>运行环境：<span>{$sys_info.software}</span></p>
              <p>PHP版本：<span>{$sys_info.php_version}</span></p>
              <p>Mysql版本：<span>{$sys_info.mysql_verison}</span></p>
              <p>主机ip：<span>{$sys_info.sys_ip}</span></p>
              <p>域名：<span>{$sys_info.host}</span></p>
              <p>默认端口：<span>{$sys_info.port}</span></p>
              <p>Zend版本：<span>{$sys_info.zend_version}</span></p>
              <p>Mb_string：<span>{$sys_info.mb_string}</span></p>
              <p>Openssl：<span>{$sys_info.openssl}</span></p>
              <p>Curl：<span>{$sys_info.curl}</span></p>
              <p>Gd：<span>{$sys_info.gd_info}</span></p>
              <p>客户端ip：<span>{$sys_info.user_ip}</span></p>
            </div>
          </div>
        </div>
      </div>

    </div>

  </div>
  <script src="__JS__/my.jquery.js"></script>
  <script src="__JS__/my.table.js"></script>
  <script src="__JS__/jsencrypt/jsencrypt.min.js"></script>
  <script src="__JS__/common.js"></script>
  <script type="text/javascript">
    $.ready(function () {

      //初始化表格
      var table = $.table({
        id: '#user-log', //表格挂载元素id
        // classes: 'table-striped', 设置样式
        url: '{:url("admin/Index/getLog")}', //url
        method: 'post', //post
        dataType: 'json',
        pagination: true, //分页
        limit: 10, //返回数据量
        // padding: true, //当返回数据小于limit时 补齐剩下的行数
        sortOrder: 'desc', //asc升序 desc降序
        queryParams: function (params) {
          var temp = {
            limit: params.limit, // 每页数据量
            page: params.page, //页码
          };
          return temp;
        },
        // 传送静态的头部信息
        // ajaxOptions:{
        //     'Access-token': dataHelper($('[name="token"]').value),
        //     'Access-token2': dataHelper(window.location.host), //伪装 发送域名
        // },
        ajaxOptions: ajaxOptions,
        //表头
        columns: [{
          field: 'id',
          title: 'ID',
          align: 'center', //居中
        }, {
          field: 'get_user',
          title: '操作用户',
          align: 'center', //居中
        }, {
          field: 'get_name',
          title: '操作名称',
          align: 'center', //居中
        }, {
          field: 'state',
          title: '操作状态',
          align: 'center', //居中
          formatter: function (value, row, index) {
            // console.log(value);
            var classes;
            if (value === 0) {
              classes = 'warning';
              value = '失败';
            } else if (value === 1) {
              classes = 'success';
              value = '成功';
            } else if (value === 2) {
              classes = 'danger';
              value = '危险';
            } else {
              return value;
            }
            //返回徽章样式
            return '<span class="badge badge-' + classes + '">' + value + '</span>';
          }
        }, {
          field: 'get_desc',
          title: '操作说明',
          align: 'center', //居中
        }, {
          field: 'ip',
          title: '操作IP',
          align: 'center', //居中
        }, {
          field: 'get_time',
          title: '操作时间',
          align: 'center', //居中
          formatter: function (value, row, index) {
            //格式化时间
            return getFormatDate('Y-M-d h:m:s', value);
          }
        }],
        onLoadSuccess: function (data) {
          //刷新token
          refreshToken();
          console.log('获取数据成功');
        },
        onLoadError: function () {
          //刷新token
          refreshToken();
          console.log('获取数据失败');
        },
      });

      //当清空日志按钮发生点击时
      $('#clear_log').on('click', function () {
        //提示用户
        var good = confirm("您正在进行清空日志操作，请问是否要继续？");
        if (good !== true) return false;
        //用户确认之后开始进行ajax请求
        $.cookie('heypass_token', dataHelper('HeyPass' + Math.random()));
        $.ajax({
          url: '{:url("admin/Index/delLog")}',
          type: 'post',
          dataType: 'json',
          data: {
            'id': dataHelper(String(Math.floor(Math.random() * 10))),
          },
          headers: {
            'Access-token': dataHelper($('[name="token"]').value),
            'Access-token2': dataHelper(window.location.host), //伪装 发送域名
          },
          success: function (res, code, xmlhttp) {
            //刷新token
            refreshToken();
            if (res.status === 200) {
              refreshToken();
              showTopMessage('清理日志成功，正在刷新表格，请稍候~', true, 1500);
              //1.5秒后开始进行刷新操作
              setTimeout(function () {
                table.refresh(); //刷新表格
              }, 1500);
              return;
            }
            showTopMessage(res.mess + ',' + res.data, false, 1500);
          },
          error: function (obj, status) {
            refreshToken();
            showTopMessage('请检查网络情况或稍后再试', false, 1500);
          }
        });
      });

      //当使用教程发生点击事件时
      $('#help').on('click', function () {
        window.parent.$.home.createTab('{:url("admin/Index/help")}', '使用教程');
      });

      //当随机密码发生点击事件时
      $('#rand').on('click', function () {
        window.parent.$.home.createTab('{:url("admin/Password/rand")}', '随机密码');
      });

      //my-table请求头
      function ajaxOptions() {
        var token = $('[name="token"]').value;
        var params = {
          'Access-token': dataHelper(token),
          'Access-token2': dataHelper(window.location.host),
        };
        return params;
      }
    });
  </script>
</body>

</html>