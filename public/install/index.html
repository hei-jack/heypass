<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="renderer" content="webkit" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- 引入ico图标 -->
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <title>HeyPass-安装向导</title>
    <link rel="stylesheet" type="text/css" href="../static/my_jquery/css/materialdesignicons.min.css">
    <link rel="stylesheet" type="text/css" href="../static/my_jquery/css/base.css">
    <link rel="stylesheet" type="text/css" href="../static/my_jquery/css/style.css">
    <style>
      /* 背景图 */
      body{
      background: url('https://w.wallhaven.cc/full/k7/wallhaven-k7xreq.jpg') no-repeat center 0px;
      background-size: cover;
      background-position: center 0;
      background-repeat: no-repeat;
      background-attachment: fixed;
      -webkit-background-size: cover;
      -o-background-size: cover;
      -moz-background-size: cover;
      -ms-background-size: cover;
      }

      /* 水平垂直居中 */
      .col-center{
      margin: 0 auto;
      position: absolute;
      left: 50%;
      top: 50%;
      /* 兼容IE9及以上浏览器 */
      -webkit-transform: translate(-50%, -50%);
      -moz-transform: translate(-50%, -50%);
      -ms-transform: translate(-50%, -50%);
      -o-transform: translate(-50%, -50%);
      transform: translate(-50%, -50%);
      }

      .card-header div.card-title {
      font-size: 20px;
      }
      /* 步骤进度条 */
      .nav {
      display: -ms-flexbox;
      display: flex;
      -ms-flex-wrap: wrap;
      flex-wrap: wrap;
      padding-left: 0;
      margin-bottom: 1rem;
      }
      .nav-step .nav-item {
      position: relative;
      float: left;
      display: -webkit-box;
      display: flex;
      -webkit-box-orient: vertical;
      -webkit-box-direction: normal;
      flex-direction: column;
      -webkit-box-flex: 1;
      -webkit-box-align: center;
      align-items: center;
      flex: 1 1;
      padding: 0 12px;
      font-size: 0;
      width: 25%;
      height: 68px;
      }

      .nav-item span{
      width: 100%;
      display: block;
      font-size: 14px;
      }

      .nav-step .nav-link {
      display: -webkit-inline-box;
      display: inline-flex;
      margin: 10px 0;
      width: 29px;
      height: 29px;
      max-height: 29px;
      border-radius: 50%;
      color: #33cabb;
      background-color: #f7fafc;
      -webkit-transition: .3s linear;
      transition: .3s linear;
      z-index: 1;
      }

      .nav-step .nav-item.complete .nav-link, .nav-step .nav-item.complete .nav-link::before, .nav-step .nav-item
      .nav-link.active, .nav-step .nav-item .nav-link.active::before {
      background-color: #dcfcfa;
      }



      .nav-step .nav-item.complete .nav-link::after, .nav-step .nav-item .nav-link.active::after {
      background-color: #33cabb;
      width: 24px;
      height: 24px;
      -webkit-transform: translateX(0);
      transform: translateX(0);
      color: #fff;
      }

      .nav-step .nav-item.complete .nav-link::after {
      width: 29px;
      height: 29px;
      -webkit-transform: translateX(0);
      transform: translateX(0);
      color: #fff;
      }

      .nav-step .nav-item .nav-link.active::after {
      width: 13px;
      height: 13px;
      margin-top: 8px;
      -webkit-transform: translateX(8px);
      transform: translateX(8px);
      color: transparent;
      }

      .nav-step .nav-link::before {
      content: '';
      position: absolute;
      left: calc(-50% + 14.5px);
      right: calc(50% + 14.5px); 
      height: 10px;
      margin-top: 9.5px;
      background-color: #eceef0;
      cursor: default;
      -webkit-transition: .5s;
      transition: .5s;
      }

      .nav-step .nav-link::after {
      content: "\f12c";
      font-family: "Material Design Icons";
      width: 0;
      height: 0;
      text-align: center;
      font-size: 15px;
      position: absolute;
      border-radius: 50%;
      background-color: transparent;
      color: transparent;
      -webkit-transform: translate(14.5px, 14.5px);
      -ms-transform: translate(14.5px, 14.5px);
      transform: translate(14.5px, 14.5px);
      -webkit-transition: .5s;
      transition: .5s;
      z-index: 1;
      display: -webkit-inline-box;
      display: inline-flex;
      -webkit-box-align: center;
      align-items: center;
      -webkit-box-pack: center;
      justify-content: center;
      }

      .nav-step .nav-item:first-child a::before {
      display: none;
      }

      .support{
        position: relative;
        float: right;
        /* display: inline-block; */
        /* margin-right: 20px; */
        vertical-align: text-bottom;
        width: 20px;
        height: 20px;
        background-color: transparent;
        border-radius: 50%;
        cursor: default;
        pointer-events: none;
      }

      [data-flag='1']{
        background-color: #00fc71;
      }
      
      [data-flag='0']{
        background-color: #fa4949;
      }

      .support::after{
      content: "";
      font-family: "Material Design Icons";
      width: 20px;
      height: 20px;
      text-align: center;
      font-size: 15px;
      position: absolute;
      left: 0;
      border-radius: 50%;
      background-color: transparent;
      color: #fff;
      -webkit-transition: .5s;
      transition: .5s;
      z-index: 1;
      display: -webkit-inline-box;
      display: inline-flex;
      -webkit-box-align: center;
      align-items: center;
      -webkit-box-pack: center;
      justify-content: center;
      }

      [data-flag='1']::after{
      content: "\f12c";
      }

      [data-flag='0']::after{
        content: "\f156";
      }
    </style>
    <!--[if IE 9]>
      <style>
        /* 兼容ie9 */
        .nav-step .nav-link{
         display: inline-block;
        }
        .nav-step .nav-link::after{
          line-height: 29px;
        }
        .support::after{
          line-height: 20px;
        }
      </style>
       <![endif]-->
  </head>
  <body>
    <!-- 密码列表 -->
    <div class="container-fluid p-t-15">

      <div class="row">
        <div class="col-lg-4 col-center">
          <div class="card">
            <header class="card-header">
              <div class="card-title">HeyPass-安装向导</div>
            </header>
            <div class="card-body">

              <!-- 步骤向导 -->
              <ul class="nav nav-step text-center">
                <li class="nav-item complete">
                  <span>环境检测</span>
                  <a class="nav-link active" data-toggle="tab" href="/install/index.html"></a>
                </li>

                <li class="nav-item">
                  <span>主题设置</span>
                  <a class="nav-link" data-toggle="tab" href="/install/step2.html"></a>
                </li>

                <li class="nav-item">
                  <span>数据库设置</span>
                  <a class="nav-link" data-toggle="tab" href="#step-3"></a>
                </li>

                <li class="nav-item">
                  <span>初始设置</span>
                  <a class="nav-link" data-toggle="tab" href="#step-4"></a>
                </li>
              </ul>

              <!-- 步骤内容 -->
              <div class="server-info clear">
                <p class="fs-16 lh-18">操作系统：<span></span><a class="support" data-info="system" href="javascript(0);"></a></p>
                <p class="fs-16 lh-18">PHP版本：<span></span><a class="support" data-info="php_vesion"  href="javascript(0);"></a></p>
                <p class="fs-16 lh-18">mysqli拓展：<span></span><a class="support" data-info="mysqli"  href="javascript(0);"></a></p>
                <p class="fs-16 lh-18">openssl拓展：<span></span><a class="support" data-info="openssl"  href="javascript(0);"></a></p>
                <p class="fs-16 lh-18">gd拓展：<span></span><a class="support" data-info="gd"  href="javascript(0);"></a></p>
                <p class="fs-16 lh-18">mb_string拓展：<span></span><a class="support" data-info="mb_string"  href="javascript(0);"></a></p>
              </div>
              
              <button type="button" class="btn btn-default">上一步</button>
              <button type="button" class="btn btn-primary float-right" id="next-btn">下一步</button>
            </div>

            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="../static/my_jquery/js/my.jquery.js"></script>
    <script type="text/javascript">
      $.ready(function () {
          $.ajax({
            url: './controller.php?a=index',
            type: 'post',
            dataType: 'json',
            data: {
              'action': 'index'
            },
            success: function (res, code, xmlhttp) {
              //如果返回的不是合法数据 就弹窗警告
              if (res.status !== 200) {
                alert(res.mess);
                return false;
              }
              //否则将接受到的数据渲染到页面
              var data = res.data;
              var info = $('.support');
              var len = info.length;
              info[0].previousElementSibling.innerText = data[info[0].getAttribute('data-info')]; //系统
              info[0].setAttribute('data-flag', 1);
              info[1].previousElementSibling.innerText = data[info[1].getAttribute('data-info')];
              //简单判断php版本是否符合要求
              var version = data[info[1].getAttribute('data-info')].split('.');
              var type_flag = version[0] <= 5 && version[1] < 6 ? 0 : 1;  //小于5.6的版本 只看前两位
              info[1].setAttribute('data-flag', type_flag); //遍历添加数据
              for (var i = 2; i < len; i++) {
                var key = info[i].getAttribute('data-info'); type_flag = data[key] === 'YES' ? 1 : 0;
                info[i].setAttribute('data-flag', type_flag); info[i].previousElementSibling.innerText = data[key];
              }
            },
            error: function (obj, status) {
              alert('请检查网络或者稍后重试！');
            }
          });

          //当下一步按钮发生点击时
          $('#next-btn').on('click', function () {
            var flag = true;
            //遍历data-flag属性
            var info = $('.support');
            var len = info.length;
            for(var i = 0;i < len;i++){
              if(info[i].getAttribute('data-flag') === 0){
                flag = false;
                break;
              }
            }
            if(!flag){
              alert('当前环境不建议进行安装HeyPass');
              return false;
            }

            //环境满足条件 则设置cookie 并跳转页面
            $.cookie('setp1','YES',{exdays:1});
            window.location.href = window.location.protocol + '/install/step2.html';
          });
        });
    </script>
  </body>
</html>